server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.php index.html;

  # Static assets - serve directly
  location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 30d;
    add_header Cache-Control "public, immutable";
  }

  # PHP handler
  location ~ \.php$ {
    try_files $uri =404;
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name;
    fastcgi_param DOCUMENT_ROOT /var/www/html;
    fastcgi_pass php:9000;
  }

  # Non-language-prefixed pages - serve correct PHP file directly
  location = /jobs {
    rewrite ^/jobs/?$ /jobs.php last;
  }
  location = /reliability {
    rewrite ^/reliability/?$ /reliability.php last;
  }
  location = /imprint {
    rewrite ^/imprint/?$ /imprint.php last;
  }
  location = /blog {
    rewrite ^/blog/?$ /blog/index.php last;
  }

  # Root redirect to index.php which will handle language detection
  location = / {
    rewrite ^/$ /index.php last;
  }

  # Language prefix routing - main pages
  location ~ ^/(en|de|nl)/?$ {
    rewrite ^/([^/]+)/?$ /index.php last;
  }

  # Language prefix routing - subpages (jobs, reliability, imprint)
  location ~ ^/(en|de|nl)/(imprint|jobs|reliability)/?$ {
    rewrite ^/([^/]+)/(.*)$ /$2.php last;
  }

  # Language prefix routing - blog
  location ~ ^/(en|de|nl)/blog {
    rewrite ^/([^/]+)/blog/?$ /blog/index.php last;
    try_files $uri $uri/ /blog/index.php;
  }

  # Default fallback for language-prefixed paths
  location ~ ^/(en|de|nl)/ {
    try_files $uri $uri/ /index.php;
  }
}

